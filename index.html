<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Initial D Street Stage - è½¬é€Ÿè¡¨ç›˜æ›¿æ¢å·¥å…·</title>
<link rel="icon" type="image/png" href="CAUGE/caution_overspeed.png">
<style>
/* ===== CSS Reset & Variables ===== */
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

:root {
  --bg-primary: #0a0e17;
  --bg-secondary: #111827;
  --bg-card: #1a2236;
  --bg-card-hover: #1f2a42;
  --accent: #e63946;
  --accent-glow: rgba(230, 57, 70, 0.3);
  --accent-light: #ff6b6b;
  --text-primary: #f0f0f0;
  --text-secondary: #9ca3af;
  --text-muted: #6b7280;
  --border: #2a3550;
  --border-light: #374361;
  --success: #10b981;
  --warning: #f59e0b;
  --blue: #3b82f6;
  --radius: 12px;
  --radius-lg: 16px;
  --shadow: 0 4px 24px rgba(0,0,0,0.4);
  --transition: 0.25s ease;
}

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans SC', sans-serif;
  background: var(--bg-primary);
  color: var(--text-primary);
  min-height: 100vh;
  overflow-x: hidden;
}

/* ===== Background Animation ===== */
body::before {
  content: '';
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  background: 
    radial-gradient(ellipse at 20% 50%, rgba(230,57,70,0.08) 0%, transparent 50%),
    radial-gradient(ellipse at 80% 20%, rgba(59,130,246,0.06) 0%, transparent 50%),
    radial-gradient(ellipse at 50% 80%, rgba(16,185,129,0.05) 0%, transparent 50%);
  pointer-events: none;
  z-index: 0;
}

/* ===== Header ===== */
.header {
  position: sticky;
  top: 0;
  z-index: 100;
  background: rgba(10,14,23,0.92);
  backdrop-filter: blur(20px);
  border-bottom: 1px solid var(--border);
  padding: 0 24px;
}

.header-inner {
  max-width: 1200px;
  margin: 0 auto;
  display: flex;
  align-items: center;
  justify-content: space-between;
  height: 64px;
}

.logo {
  display: flex;
  align-items: center;
  gap: 12px;
  text-decoration: none;
  color: var(--text-primary);
}

.logo-icon {
  font-size: 28px;
  filter: drop-shadow(0 0 8px var(--accent-glow));
}

.logo-text {
  font-size: 18px;
  font-weight: 700;
  letter-spacing: -0.3px;
}

.logo-text span {
  color: var(--accent);
}

.nav {
  display: flex;
  gap: 4px;
}

.nav-btn {
  background: none;
  border: none;
  color: var(--text-secondary);
  padding: 8px 16px;
  border-radius: 8px;
  cursor: pointer;
  font-size: 14px;
  font-weight: 500;
  transition: var(--transition);
}

.nav-btn:hover { color: var(--text-primary); background: rgba(255,255,255,0.05); }
.nav-btn.active { color: var(--accent); background: rgba(230,57,70,0.1); }

/* ===== Main Layout ===== */
.main {
  position: relative;
  z-index: 1;
  max-width: 1200px;
  margin: 0 auto;
  padding: 32px 24px 80px;
}

/* ===== Page Sections ===== */
.page { display: none; }
.page.active { display: block; animation: fadeIn 0.3s ease; }

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(8px); }
  to { opacity: 1; transform: translateY(0); }
}

/* ===== Section Title ===== */
.section-title {
  font-size: 28px;
  font-weight: 700;
  margin-bottom: 8px;
  display: flex;
  align-items: center;
  gap: 12px;
}

.section-subtitle {
  color: var(--text-secondary);
  font-size: 15px;
  margin-bottom: 32px;
  line-height: 1.6;
}

/* ===== Gauge Grid ===== */
.gauge-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
  gap: 24px;
  margin-bottom: 32px;
}

.gauge-card {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: var(--radius-lg);
  overflow: hidden;
  transition: var(--transition);
  cursor: pointer;
}

.gauge-card:hover {
  border-color: var(--accent);
  box-shadow: 0 0 20px var(--accent-glow);
  transform: translateY(-2px);
}

.gauge-card-image {
  width: 100%;
  aspect-ratio: 1;
  object-fit: contain;
  background: radial-gradient(circle, rgba(30,40,60,1) 0%, rgba(10,14,23,1) 100%);
  padding: 20px;
}

.gauge-card-body {
  padding: 16px 20px 20px;
}

.gauge-card-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 8px;
}

.gauge-card-name {
  font-size: 17px;
  font-weight: 600;
}

.badge {
  font-size: 11px;
  font-weight: 600;
  padding: 3px 10px;
  border-radius: 20px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.badge-preset {
  background: rgba(230,57,70,0.15);
  color: var(--accent-light);
  border: 1px solid rgba(230,57,70,0.3);
}

.badge-custom {
  background: rgba(59,130,246,0.15);
  color: #60a5fa;
  border: 1px solid rgba(59,130,246,0.3);
}

.gauge-card-desc {
  color: var(--text-secondary);
  font-size: 13px;
  line-height: 1.5;
  margin-bottom: 16px;
}

.gauge-card-actions {
  display: flex;
  gap: 8px;
}

/* ===== Buttons ===== */
.btn {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 8px 16px;
  border-radius: 8px;
  font-size: 13px;
  font-weight: 600;
  border: none;
  cursor: pointer;
  transition: var(--transition);
  text-decoration: none;
}

.btn-primary {
  background: var(--accent);
  color: white;
}
.btn-primary:hover { background: #d32f3f; box-shadow: 0 0 16px var(--accent-glow); }

.btn-secondary {
  background: rgba(255,255,255,0.08);
  color: var(--text-primary);
  border: 1px solid var(--border);
}
.btn-secondary:hover { background: rgba(255,255,255,0.12); border-color: var(--border-light); }

.btn-success {
  background: var(--success);
  color: white;
}
.btn-success:hover { background: #0d9668; }

.btn-blue {
  background: var(--blue);
  color: white;
}
.btn-blue:hover { background: #2563eb; }

.btn-lg {
  padding: 12px 24px;
  font-size: 15px;
  border-radius: 10px;
}

.btn-icon {
  width: 40px;
  height: 40px;
  padding: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 10px;
  font-size: 18px;
}

/* ===== Upload Area ===== */
.upload-area {
  border: 2px dashed var(--border);
  border-radius: var(--radius-lg);
  padding: 48px 24px;
  text-align: center;
  cursor: pointer;
  transition: var(--transition);
  background: rgba(255,255,255,0.02);
  margin-bottom: 32px;
}

.upload-area:hover {
  border-color: var(--accent);
  background: rgba(230,57,70,0.04);
}

.upload-area.dragover {
  border-color: var(--accent);
  background: rgba(230,57,70,0.08);
  box-shadow: 0 0 30px var(--accent-glow);
}

.upload-icon { font-size: 48px; margin-bottom: 16px; opacity: 0.6; }
.upload-text { font-size: 16px; font-weight: 600; margin-bottom: 8px; }
.upload-hint { color: var(--text-muted); font-size: 13px; }

/* ===== Modal / Preview ===== */
.modal-overlay {
  display: none;
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  background: rgba(0,0,0,0.85);
  backdrop-filter: blur(8px);
  z-index: 200;
  align-items: center;
  justify-content: center;
  padding: 24px;
}

.modal-overlay.active { display: flex; }

.modal {
  background: var(--bg-secondary);
  border: 1px solid var(--border);
  border-radius: var(--radius-lg);
  max-width: 560px;
  width: 100%;
  max-height: 90vh;
  overflow-y: auto;
  box-shadow: var(--shadow);
}

.modal-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 20px 24px;
  border-bottom: 1px solid var(--border);
}

.modal-title { font-size: 18px; font-weight: 700; }

.modal-close {
  background: none;
  border: none;
  color: var(--text-secondary);
  font-size: 24px;
  cursor: pointer;
  padding: 4px;
  line-height: 1;
  transition: var(--transition);
}
.modal-close:hover { color: var(--text-primary); }

.modal-body { padding: 24px; }

.modal-preview-img {
  width: 100%;
  max-width: 400px;
  margin: 0 auto 24px;
  display: block;
  border-radius: var(--radius);
}

.modal-actions {
  display: flex;
  gap: 12px;
  justify-content: center;
  flex-wrap: wrap;
}

/* ===== Download Package Section ===== */
.package-section {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: var(--radius-lg);
  padding: 32px;
  margin-top: 32px;
}

.package-title {
  font-size: 20px;
  font-weight: 700;
  margin-bottom: 12px;
  display: flex;
  align-items: center;
  gap: 10px;
}

.package-desc {
  color: var(--text-secondary);
  font-size: 14px;
  line-height: 1.7;
  margin-bottom: 20px;
}

.package-actions {
  display: flex;
  gap: 12px;
  flex-wrap: wrap;
}

/* ===== Platform Tabs ===== */
.platform-tabs {
  display: flex;
  gap: 8px;
  margin-bottom: 24px;
  padding: 4px;
  background: rgba(255,255,255,0.04);
  border-radius: 10px;
  width: fit-content;
}

.platform-tab {
  padding: 8px 20px;
  border-radius: 8px;
  border: none;
  background: none;
  color: var(--text-secondary);
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  transition: var(--transition);
}

.platform-tab.active {
  background: var(--accent);
  color: white;
}

.platform-content { display: none; }
.platform-content.active { display: block; }

/* ===== Settings / Help / About Pages ===== */
.info-card {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: var(--radius-lg);
  padding: 28px;
  margin-bottom: 20px;
}

.info-card h3 {
  font-size: 17px;
  font-weight: 700;
  margin-bottom: 12px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.info-card p, .info-card li {
  color: var(--text-secondary);
  font-size: 14px;
  line-height: 1.8;
}

.info-card ul, .info-card ol {
  padding-left: 20px;
}

.info-card li { margin-bottom: 8px; }

.info-card code {
  background: rgba(255,255,255,0.08);
  padding: 2px 8px;
  border-radius: 4px;
  font-family: 'Consolas', 'Monaco', monospace;
  font-size: 13px;
  color: var(--accent-light);
}

.info-card pre {
  background: rgba(0,0,0,0.3);
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 16px;
  overflow-x: auto;
  margin: 12px 0;
  font-size: 13px;
  line-height: 1.6;
}

.info-card pre code {
  background: none;
  padding: 0;
  color: var(--text-primary);
}

/* ===== About Author ===== */
.author-card {
  text-align: center;
  padding: 48px 32px;
}

.author-avatar {
  width: 120px;
  height: 120px;
  border-radius: 50%;
  border: 3px solid var(--accent);
  margin-bottom: 20px;
  box-shadow: 0 0 24px var(--accent-glow);
}

.author-name {
  font-size: 24px;
  font-weight: 700;
  margin-bottom: 8px;
}

.author-desc {
  color: var(--text-secondary);
  font-size: 15px;
  margin-bottom: 24px;
  line-height: 1.6;
}

.author-link {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  color: #00a1d6;
  text-decoration: none;
  font-size: 16px;
  font-weight: 600;
  padding: 12px 28px;
  border-radius: 10px;
  background: rgba(0,161,214,0.1);
  border: 1px solid rgba(0,161,214,0.3);
  transition: var(--transition);
}

.author-link:hover {
  background: rgba(0,161,214,0.2);
  box-shadow: 0 0 20px rgba(0,161,214,0.2);
}

/* ===== Selected Gauges List ===== */
.selected-list {
  margin-top: 16px;
}

.selected-item {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 12px 16px;
  background: rgba(255,255,255,0.03);
  border: 1px solid var(--border);
  border-radius: 10px;
  margin-bottom: 8px;
}

.selected-item img {
  width: 48px;
  height: 48px;
  border-radius: 8px;
  object-fit: contain;
  background: var(--bg-primary);
}

.selected-item-name {
  flex: 1;
  font-size: 14px;
  font-weight: 600;
}

.selected-item .btn-remove {
  background: none;
  border: none;
  color: var(--text-muted);
  cursor: pointer;
  font-size: 18px;
  padding: 4px;
  transition: var(--transition);
}

.selected-item .btn-remove:hover { color: var(--accent); }

/* ===== Toast ===== */
.toast {
  position: fixed;
  bottom: 32px;
  left: 50%;
  transform: translateX(-50%) translateY(100px);
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: 10px;
  padding: 12px 24px;
  font-size: 14px;
  font-weight: 600;
  box-shadow: var(--shadow);
  z-index: 300;
  transition: transform 0.3s ease;
  display: flex;
  align-items: center;
  gap: 8px;
}

.toast.show { transform: translateX(-50%) translateY(0); }
.toast.success { border-color: var(--success); }
.toast.error { border-color: var(--accent); }

/* ===== Responsive ===== */
@media (max-width: 768px) {
  .header-inner { padding: 0; }
  .logo-text { font-size: 15px; }
  .nav-btn { padding: 6px 10px; font-size: 13px; }
  .main { padding: 20px 16px 60px; }
  .gauge-grid { grid-template-columns: 1fr; }
  .section-title { font-size: 22px; }
  .modal { margin: 16px; }
}

@media (max-width: 480px) {
  .nav { gap: 0; }
  .nav-btn { padding: 6px 8px; font-size: 12px; }
  .logo-text { display: none; }
}

/* ===== Scrollbar ===== */
::-webkit-scrollbar { width: 8px; }
::-webkit-scrollbar-track { background: var(--bg-primary); }
::-webkit-scrollbar-thumb { background: var(--border); border-radius: 4px; }
::-webkit-scrollbar-thumb:hover { background: var(--border-light); }
</style>
</head>
<body>

<!-- Header -->
<header class="header">
  <div class="header-inner">
    <a class="logo" href="#">
      <span class="logo-icon">ğŸï¸</span>
      <span class="logo-text">Initial D <span>è½¬é€Ÿè¡¨ç›˜</span></span>
    </a>
    <nav class="nav">
      <button class="nav-btn active" data-page="home">è¡¨ç›˜</button>
      <button class="nav-btn" data-page="download">ä¸‹è½½</button>
      <button class="nav-btn" data-page="help">å¸®åŠ©</button>
      <button class="nav-btn" data-page="about">å…³äº</button>
    </nav>
  </div>
</header>

<!-- Main Content -->
<main class="main">

  <!-- ===== HOME PAGE ===== -->
  <section class="page active" id="page-home">
    <h1 class="section-title">ğŸ”§ é€‰æ‹©è½¬é€Ÿè¡¨ç›˜</h1>
    <p class="section-subtitle">
      é€‰æ‹©ä¸€ä¸ªé¢„åˆ¶è¡¨ç›˜æˆ–ä¸Šä¼ ä½ è‡ªå·±çš„è¡¨ç›˜å›¾ç‰‡ï¼Œç„¶åå‰å¾€ã€Œä¸‹è½½ã€é¡µé¢ç”Ÿæˆæ›¿æ¢æ–‡ä»¶åŒ…ã€‚
    </p>

    <!-- Gauge Grid -->
    <div class="gauge-grid" id="gaugeGrid">
      <!-- Preset 1 -->
      <div class="gauge-card" data-gauge="snow_girl" data-type="preset">
        <img class="gauge-card-image" src="CAUGE/snow_girl.png" alt="é›ªå¥³">
        <div class="gauge-card-body">
          <div class="gauge-card-header">
            <span class="gauge-card-name">é›ªå¥³</span>
            <span class="badge badge-preset">é¢„åˆ¶</span>
          </div>
          <p class="gauge-card-desc">è“è‰²å†°é›ªä¸»é¢˜è¡¨ç›˜ï¼Œé›ªå¥³ä¸é›ªèŠ±è£…é¥°ï¼Œæ¸…æ–°å”¯ç¾é£æ ¼</p>
          <div class="gauge-card-actions">
            <button class="btn btn-secondary" onclick="previewGauge('snow_girl')">ğŸ‘ é¢„è§ˆ</button>
            <button class="btn btn-primary" onclick="selectGauge('snow_girl', 'CAUGE/snow_girl.png', 'é›ªå¥³ Â· å†°é›ªé£æš´', 'preset')">âœ… é€‰æ‹©</button>
          </div>
        </div>
      </div>

      <!-- Preset 2 -->
      <div class="gauge-card" data-gauge="caution_overspeed" data-type="preset">
        <img class="gauge-card-image" src="CAUGE/caution_overspeed.png" alt="CAUTION OVERSPEED!">
        <div class="gauge-card-body">
          <div class="gauge-card-header">
            <span class="gauge-card-name">æ·±çº¢1å·</span>
            <span class="badge badge-preset">é¢„åˆ¶</span>
          </div>
          <p class="gauge-card-desc">çº¢è‰²è­¦å‘Šé£æ ¼è¡¨ç›˜ï¼Œéœ¸æ°”åè¶³ï¼Œè¶…é€Ÿè­¦å‘Šä¸»é¢˜è®¾è®¡</p>
          <div class="gauge-card-actions">
            <button class="btn btn-secondary" onclick="previewGauge('caution_overspeed')">ğŸ‘ é¢„è§ˆ</button>
            <button class="btn btn-primary" onclick="selectGauge('caution_overspeed', 'CAUGE/caution_overspeed.png', 'CAUTION OVERSPEED!', 'preset')">âœ… é€‰æ‹©</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Upload Custom -->
    <div class="upload-area" id="uploadArea">
      <div class="upload-icon">ğŸ“</div>
      <div class="upload-text">ä¸Šä¼ è‡ªå®šä¹‰è¡¨ç›˜</div>
      <div class="upload-hint">æ‹–æ‹½ PNG/JPG å›¾ç‰‡åˆ°æ­¤å¤„ï¼Œæˆ–ç‚¹å‡»é€‰æ‹©æ–‡ä»¶</div>
      <input type="file" id="fileInput" accept="image/png,image/jpeg,image/bmp" style="display:none" multiple>
    </div>

    <!-- Custom Gauges -->
    <div id="customGaugesContainer" style="display:none">
      <h2 style="font-size:20px; font-weight:700; margin-bottom:16px;">ğŸ“Œ è‡ªå®šä¹‰è¡¨ç›˜</h2>
      <div class="gauge-grid" id="customGaugeGrid"></div>
    </div>
  </section>

  <!-- ===== DOWNLOAD PAGE ===== -->
  <section class="page" id="page-download">
    <h1 class="section-title">ğŸ“¦ ä¸‹è½½æ›¿æ¢æ–‡ä»¶</h1>
    <p class="section-subtitle">
      é€‰æ‹©ä½ çš„å¹³å°ï¼Œç”Ÿæˆå¹¶ä¸‹è½½è¡¨ç›˜æ›¿æ¢æ–‡ä»¶åŒ…ã€‚å°†æ–‡ä»¶æ”¾å…¥å¯¹åº”ç›®å½•å³å¯å®Œæˆæ›¿æ¢ã€‚
    </p>

    <!-- Current Selection -->
    <div class="info-card" id="selectionCard">
      <h3>ğŸ¯ å½“å‰é€‰æ‹©çš„è¡¨ç›˜</h3>
      <div id="currentSelection">
        <p style="color:var(--text-muted)">å°šæœªé€‰æ‹©ä»»ä½•è¡¨ç›˜ï¼Œè¯·å‰å¾€ã€Œè¡¨ç›˜ã€é¡µé¢é€‰æ‹©ã€‚</p>
      </div>
    </div>

    <!-- Platform Tabs -->
    <div class="platform-tabs">
      <button class="platform-tab active" data-platform="windows">ğŸ–¥ Windows</button>
      <button class="platform-tab" data-platform="android">ğŸ“± Android</button>
    </div>

    <!-- Windows -->
    <div class="platform-content active" id="platform-windows">
      <div class="package-section">
        <div class="package-title">ğŸ–¥ Windows ç‰ˆæ–‡ä»¶åŒ…</div>
        <div class="package-desc">
          ä¸‹è½½åå°†æ–‡ä»¶è§£å‹åˆ° PPSSPP æè´¨ç›®å½•ï¼š<br>
          <code>C:\Users\ä½ çš„ç”¨æˆ·å\Documents\PPSSPP\PSP\TEXTURES\ULJM05093\</code><br><br>
          æ–‡ä»¶åŒ…å†…å«ï¼š
          <ul style="margin-top:8px; padding-left:20px;">
            <li><code>textures.ini</code> â€” æè´¨é…ç½®æ–‡ä»¶ï¼ˆæ”¾åœ¨ ULJM05093 æ ¹ç›®å½•ï¼‰</li>
            <li><code>CAUGE/speed1.png</code> â€” ä½ é€‰æ‹©çš„è¡¨ç›˜å›¾ç‰‡</li>
          </ul>
        </div>
        <div class="package-actions">
          <button class="btn btn-primary btn-lg" onclick="downloadPackage('windows')" id="btnDownloadWin">
            ğŸ“¥ ä¸‹è½½ Windows æ–‡ä»¶åŒ…
          </button>
          <button class="btn btn-secondary btn-lg" onclick="downloadIniOnly()">
            ğŸ“„ ä»…ä¸‹è½½ textures.ini
          </button>
        </div>
      </div>
    </div>

    <!-- Android -->
    <div class="platform-content" id="platform-android">
      <div class="package-section">
        <div class="package-title">ğŸ“± Android ç‰ˆæ–‡ä»¶åŒ…</div>
        <div class="package-desc">
          ä¸‹è½½åå°†æ–‡ä»¶æ”¾åˆ° PPSSPP å®‰å“ç‰ˆæè´¨ç›®å½•ï¼š<br>
          <code>/Android/data/org.ppsspp.ppsspp/files/PSP/TEXTURES/ULJM05093/</code><br><br>
          æ³¨æ„ï¼šAndroid 11 åŠä»¥ä¸Šç‰ˆæœ¬å— Scoped Storage é™åˆ¶ï¼Œå¯èƒ½éœ€è¦ä½¿ç”¨æ–‡ä»¶ç®¡ç†å™¨ï¼ˆå¦‚ MTç®¡ç†å™¨ï¼‰è®¿é—®è¯¥è·¯å¾„ã€‚<br><br>
          æ–‡ä»¶åŒ…å†…å«ï¼š
          <ul style="margin-top:8px; padding-left:20px;">
            <li><code>textures.ini</code> â€” æè´¨é…ç½®æ–‡ä»¶ï¼ˆæ”¾åœ¨ ULJM05093/new/ ç›®å½•ï¼‰</li>
            <li><code>CAUGE/speed1.png</code> â€” ä½ é€‰æ‹©çš„è¡¨ç›˜å›¾ç‰‡</li>
          </ul>
        </div>
        <div class="package-actions">
          <button class="btn btn-primary btn-lg" onclick="downloadPackage('android')" id="btnDownloadAndroid">
            ğŸ“¥ ä¸‹è½½ Android æ–‡ä»¶åŒ…
          </button>
          <button class="btn btn-secondary btn-lg" onclick="downloadIniOnly()">
            ğŸ“„ ä»…ä¸‹è½½ textures.ini
          </button>
        </div>
      </div>
    </div>
  </section>

  <!-- ===== HELP PAGE ===== -->
  <section class="page" id="page-help">
    <h1 class="section-title">ğŸ“– ä½¿ç”¨å¸®åŠ©</h1>
    <p class="section-subtitle">æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼Œè½»æ¾æ›¿æ¢ Initial D Street Stage çš„è½¬é€Ÿè¡¨ç›˜ã€‚</p>

    <div class="info-card">
      <h3>ğŸ“‹ æ“ä½œæ­¥éª¤</h3>
      <ol>
        <li><strong>é€‰æ‹©è¡¨ç›˜</strong> â€” åœ¨ã€Œè¡¨ç›˜ã€é¡µé¢é€‰æ‹©ä¸€ä¸ªé¢„åˆ¶è¡¨ç›˜ï¼Œæˆ–ä¸Šä¼ ä½ è‡ªå·±åˆ¶ä½œçš„è¡¨ç›˜å›¾ç‰‡ï¼ˆæ¨è PNG æ ¼å¼ï¼Œé€æ˜èƒŒæ™¯ï¼‰ã€‚</li>
        <li><strong>ä¸‹è½½æ–‡ä»¶åŒ…</strong> â€” å‰å¾€ã€Œä¸‹è½½ã€é¡µé¢ï¼Œé€‰æ‹©ä½ çš„å¹³å°ï¼ˆWindows / Androidï¼‰ï¼Œç‚¹å‡»ä¸‹è½½æŒ‰é’®è·å– ZIP æ–‡ä»¶åŒ…ã€‚</li>
        <li><strong>è§£å‹æ–‡ä»¶</strong> â€” å°†ä¸‹è½½çš„ ZIP æ–‡ä»¶è§£å‹ã€‚</li>
        <li><strong>æ”¾å…¥æè´¨ç›®å½•</strong> â€” å°†è§£å‹åçš„ <code>textures.ini</code> å’Œ <code>CAUGE</code> æ–‡ä»¶å¤¹æ”¾å…¥ PPSSPP çš„æè´¨ç›®å½•ä¸­ï¼ˆè¯¦è§ä¸‹æ–¹è·¯å¾„è¯´æ˜ï¼‰ã€‚</li>
        <li><strong>å¯åŠ¨æ¸¸æˆ</strong> â€” åœ¨ PPSSPP æ¨¡æ‹Ÿå™¨ä¸­å¯åŠ¨ Initial D Street Stageï¼Œå³å¯çœ‹åˆ°æ›¿æ¢åçš„è½¬é€Ÿè¡¨ç›˜ã€‚</li>
      </ol>
    </div>

    <div class="info-card">
      <h3>ğŸ“‚ æè´¨ç›®å½•è·¯å¾„</h3>
      <p><strong>Windows é»˜è®¤è·¯å¾„ï¼š</strong></p>
      <pre><code>C:\Users\ä½ çš„ç”¨æˆ·å\Documents\PPSSPP\PSP\TEXTURES\ULJM05093\</code></pre>
      <p><strong>Android é»˜è®¤è·¯å¾„ï¼ˆAndroid 11+ï¼‰ï¼š</strong></p>
      <pre><code>/Android/data/org.ppsspp.ppsspp/files/PSP/TEXTURES/ULJM05093/new/</code></pre>
      <p style="margin-top:12px">
        å¦‚æœä½ ä¿®æ”¹è¿‡ PPSSPP çš„é…ç½®è·¯å¾„ï¼Œè¯·å°†æ–‡ä»¶æ”¾åˆ°ä½ è‡ªå®šä¹‰çš„æè´¨ç›®å½•ä¸­ã€‚
        å…³é”®æ˜¯ç¡®ä¿ <code>textures.ini</code> ä½äº <code>ULJM05093</code>ï¼ˆæˆ– <code>ULJM05093/new/</code>ï¼‰ç›®å½•ä¸‹ï¼Œ
        <code>CAUGE</code> æ–‡ä»¶å¤¹ä¹Ÿåœ¨åŒä¸€ç›®å½•ä¸­ã€‚
      </p>
    </div>

    <div class="info-card">
      <h3>âš ï¸ æ³¨æ„äº‹é¡¹</h3>
      <ul>
        <li>å¦‚æœä½ å·²æœ‰ <code>textures.ini</code> æ–‡ä»¶ä¸”åŒ…å«å…¶ä»–è‡ªå®šä¹‰æè´¨ï¼Œå»ºè®®æ‰‹åŠ¨åˆå¹¶è€Œéç›´æ¥è¦†ç›–ã€‚æœ¬å·¥å…·ç”Ÿæˆçš„ ini æ–‡ä»¶åªåŒ…å«è½¬é€Ÿè¡¨ç›˜çš„æ›¿æ¢é…ç½®ã€‚</li>
        <li>è¡¨ç›˜å›¾ç‰‡ä¼šè¢«é‡å‘½åä¸º <code>speed1.png</code> å¹¶æ”¾åœ¨ <code>CAUGE</code> æ–‡ä»¶å¤¹ä¸­ã€‚</li>
        <li>å¦‚æœæ›¿æ¢åæ²¡æœ‰æ•ˆæœï¼Œè¯·æ£€æŸ¥ PPSSPP è®¾ç½®ä¸­æ˜¯å¦å¯ç”¨äº†ã€Œæ›¿æ¢çº¹ç†ã€ï¼ˆReplace texturesï¼‰é€‰é¡¹ã€‚</li>
        <li>è‡ªå®šä¹‰è¡¨ç›˜æ¨èä½¿ç”¨ PNG æ ¼å¼ã€æ­£æ–¹å½¢å°ºå¯¸ã€é€æ˜èƒŒæ™¯ï¼Œä»¥è·å¾—æœ€ä½³æ•ˆæœã€‚</li>
      </ul>
    </div>

    <div class="info-card">
      <h3>ğŸ”§ textures.ini è¯´æ˜</h3>
      <p>æœ¬å·¥å…·ç”Ÿæˆçš„ <code>textures.ini</code> å†…å®¹å¦‚ä¸‹ï¼š</p>
      <pre><code>[options]
version = 1
hash = quick

[hashes]
00000000000000007ca9cd35 = CAUGE/speed1.png
00000000000000005e3eb2a4 = CAUGE/speed1.png
000000000000000077e3f8ea = CAUGE/speed1.png
099c7a90f177f24d262df61a = CAUGE/speed1.png</code></pre>
      <p style="margin-top:12px">
        å…¶ä¸­ 4 ä¸ªå“ˆå¸Œå€¼å¯¹åº”æ¸¸æˆä¸­åŒä¸€ä¸ªè½¬é€Ÿè¡¨ç›˜çš„ä¸åŒå˜é‡åœ°å€ï¼Œå…¨éƒ¨æŒ‡å‘ä½ é€‰æ‹©çš„è¡¨ç›˜å›¾ç‰‡ã€‚
      </p>
    </div>
  </section>

  <!-- ===== ABOUT PAGE ===== -->
  <section class="page" id="page-about">
    <h1 class="section-title">ğŸ‘¤ å…³äºä½œè€…</h1>
    <p class="section-subtitle">è¿™ä¸ªå·¥å…·çš„åˆ›æ„å’Œå¼€å‘</p>

    <div class="info-card author-card">
      <img class="author-avatar" src="CAUGE/caution_overspeed.png" alt="ä½œè€…å¤´åƒ">
      <div class="author-name">Initial D è½¬é€Ÿè¡¨ç›˜æ›¿æ¢å·¥å…·</div>
      <p class="author-desc">
        æœ¬å·¥å…·ç”± Bilibili UPä¸» å¼€å‘ï¼Œæ—¨åœ¨ä¸º Initial D Street Stage (PPSSPP) ç©å®¶æä¾›ä¾¿æ·çš„è½¬é€Ÿè¡¨ç›˜è‡ªå®šä¹‰ä½“éªŒã€‚<br><br>
        å¦‚æœä½ å–œæ¬¢è¿™ä¸ªå·¥å…·ï¼Œæ¬¢è¿å…³æ³¨æˆ‘çš„ Bilibili ä¸»é¡µï¼Œè·å–æ›´å¤š Initial D ç›¸å…³å†…å®¹ï¼
      </p>
      <a class="author-link" href="https://space.bilibili.com/89847924" target="_blank" rel="noopener">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M17.813 4.653h.854c1.51.054 2.769.578 3.773 1.574 1.004.995 1.524 2.249 1.56 3.76v7.36c-.036 1.51-.556 2.769-1.56 3.773s-2.262 1.524-3.773 1.56H5.333c-1.51-.036-2.769-.556-3.773-1.56S.036 18.858 0 17.347v-7.36c.036-1.511.556-2.765 1.56-3.76 1.004-.996 2.262-1.52 3.773-1.574h.774l-1.174-1.12a1.234 1.234 0 0 1-.373-.906c0-.356.124-.658.373-.907l.027-.027c.267-.249.573-.373.92-.373.347 0 .653.124.92.373L9.653 4.44c.071.071.134.142.187.213h4.267a.836.836 0 0 1 .16-.213l2.853-2.747c.267-.249.573-.373.92-.373.347 0 .662.151.929.4.267.249.391.551.391.907 0 .355-.124.657-.373.906zM5.333 7.24c-.746.018-1.373.276-1.88.773-.506.498-.769 1.13-.786 1.894v7.52c.017.764.28 1.395.786 1.893.507.498 1.134.756 1.88.773h13.334c.746-.017 1.373-.275 1.88-.773.506-.498.769-1.129.786-1.893v-7.52c-.017-.765-.28-1.396-.786-1.894-.507-.497-1.134-.755-1.88-.773zM8 11.107c.373 0 .684.124.933.373.25.249.383.569.4.96v1.173c-.017.391-.15.711-.4.96-.249.25-.56.374-.933.374s-.684-.125-.933-.374c-.25-.249-.383-.569-.4-.96V12.44c.017-.391.15-.711.4-.96.249-.249.56-.373.933-.373zm8 0c.373 0 .684.124.933.373.25.249.383.569.4.96v1.173c-.017.391-.15.711-.4.96-.249.25-.56.374-.933.374s-.684-.125-.933-.374c-.25-.249-.383-.569-.4-.96V12.44c.017-.391.15-.711.4-.96.249-.249.56-.373.933-.373z"/></svg>
        è®¿é—® Bilibili ä¸»é¡µ
      </a>
    </div>

    <div class="info-card">
      <h3>ğŸ’¡ é¡¹ç›®ä¿¡æ¯</h3>
      <ul>
        <li><strong>é€‚ç”¨æ¸¸æˆï¼š</strong>Initial D Street Stage (ULJM05093)</li>
        <li><strong>é€‚ç”¨æ¨¡æ‹Ÿå™¨ï¼š</strong>PPSSPPï¼ˆWindows / Android / å…¶ä»–å¹³å°ï¼‰</li>
        <li><strong>åŠŸèƒ½ï¼š</strong>å¯è§†åŒ–è½¬é€Ÿè¡¨ç›˜æè´¨æ›¿æ¢</li>
        <li><strong>æŠ€æœ¯ï¼š</strong>çº¯å‰ç«¯å®ç°ï¼Œæ— éœ€åç«¯æœåŠ¡å™¨ï¼Œå¯éƒ¨ç½²åˆ° GitHub Pages</li>
        <li><strong>å¼€æºåè®®ï¼š</strong>å…è´¹ä½¿ç”¨ï¼Œæ¬¢è¿åˆ†äº«</li>
      </ul>
    </div>
  </section>

</main>

<!-- Preview Modal -->
<div class="modal-overlay" id="previewModal">
  <div class="modal">
    <div class="modal-header">
      <span class="modal-title" id="previewTitle">è¡¨ç›˜é¢„è§ˆ</span>
      <button class="modal-close" onclick="closePreview()">&times;</button>
    </div>
    <div class="modal-body">
      <img class="modal-preview-img" id="previewImage" src="" alt="é¢„è§ˆ">
      <div class="modal-actions" id="previewActions"></div>
    </div>
  </div>
</div>

<!-- Toast -->
<div class="toast" id="toast"></div>

<script>
// ===== Constants =====
const TACHOMETER_HASHES = [
  '00000000000000007ca9cd35',
  '00000000000000005e3eb2a4',
  '000000000000000077e3f8ea',
  '099c7a90f177f24d262df61a'
];

const SPEED_FILENAME = 'speed1.png';

// ===== State =====
let selectedGauge = null; // { id, src, name, type, blob? }
let customGauges = []; // [{ id, name, dataUrl }]
let customIdCounter = 0;

// ===== Navigation =====
document.querySelectorAll('.nav-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    const page = btn.dataset.page;
    document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    document.getElementById('page-' + page).classList.add('active');
    if (page === 'download') updateSelectionDisplay();
  });
});

// Platform tabs
document.querySelectorAll('.platform-tab').forEach(tab => {
  tab.addEventListener('click', () => {
    document.querySelectorAll('.platform-tab').forEach(t => t.classList.remove('active'));
    tab.classList.add('active');
    document.querySelectorAll('.platform-content').forEach(c => c.classList.remove('active'));
    document.getElementById('platform-' + tab.dataset.platform).classList.add('active');
  });
});

// ===== Gauge Selection =====
function selectGauge(id, src, name, type) {
  selectedGauge = { id, src, name, type };
  
  // Update visual selection
  document.querySelectorAll('.gauge-card').forEach(card => {
    card.style.borderColor = '';
    card.style.boxShadow = '';
  });
  const card = document.querySelector(`.gauge-card[data-gauge="${id}"]`);
  if (card) {
    card.style.borderColor = 'var(--success)';
    card.style.boxShadow = '0 0 20px rgba(16,185,129,0.3)';
  }
  
  showToast('âœ… å·²é€‰æ‹©: ' + name, 'success');
}

function selectCustomGauge(id) {
  const gauge = customGauges.find(g => g.id === id);
  if (!gauge) return;
  selectedGauge = { id: gauge.id, src: gauge.dataUrl, name: gauge.name, type: 'custom' };
  
  document.querySelectorAll('.gauge-card').forEach(card => {
    card.style.borderColor = '';
    card.style.boxShadow = '';
  });
  const card = document.querySelector(`.gauge-card[data-gauge="${id}"]`);
  if (card) {
    card.style.borderColor = 'var(--success)';
    card.style.boxShadow = '0 0 20px rgba(16,185,129,0.3)';
  }
  
  showToast('âœ… å·²é€‰æ‹©: ' + gauge.name, 'success');
}

// ===== Preview =====
function previewGauge(id) {
  const modal = document.getElementById('previewModal');
  const img = document.getElementById('previewImage');
  const title = document.getElementById('previewTitle');
  const actions = document.getElementById('previewActions');
  
  let gauge;
  if (id === 'snow_girl') {
    gauge = { name: 'é›ªå¥³ Â· å†°é›ªé£æš´', src: 'CAUGE/snow_girl.png', type: 'preset', id: 'snow_girl' };
  } else if (id === 'caution_overspeed') {
    gauge = { name: 'CAUTION OVERSPEED!', src: 'CAUGE/caution_overspeed.png', type: 'preset', id: 'caution_overspeed' };
  } else {
    const custom = customGauges.find(g => g.id === id);
    if (!custom) return;
    gauge = { name: custom.name, src: custom.dataUrl, type: 'custom', id: custom.id };
  }
  
  img.src = gauge.src;
  title.textContent = gauge.name;
  
  if (gauge.type === 'preset') {
    actions.innerHTML = `
      <button class="btn btn-primary btn-lg" onclick="selectGauge('${gauge.id}', '${gauge.src}', '${gauge.name}', 'preset'); closePreview();">âœ… é€‰æ‹©æ­¤è¡¨ç›˜</button>
      <button class="btn btn-secondary btn-lg" onclick="closePreview()">å…³é—­</button>
    `;
  } else {
    actions.innerHTML = `
      <button class="btn btn-primary btn-lg" onclick="selectCustomGauge('${gauge.id}'); closePreview();">âœ… é€‰æ‹©æ­¤è¡¨ç›˜</button>
      <button class="btn btn-secondary btn-lg" onclick="removeCustomGauge('${gauge.id}'); closePreview();">ğŸ—‘ åˆ é™¤</button>
      <button class="btn btn-secondary btn-lg" onclick="closePreview()">å…³é—­</button>
    `;
  }
  
  modal.classList.add('active');
}

function closePreview() {
  document.getElementById('previewModal').classList.remove('active');
}

// Close modal on overlay click
document.getElementById('previewModal').addEventListener('click', (e) => {
  if (e.target === e.currentTarget) closePreview();
});

// ===== Custom Gauge Upload =====
const uploadArea = document.getElementById('uploadArea');
const fileInput = document.getElementById('fileInput');

uploadArea.addEventListener('click', () => fileInput.click());

uploadArea.addEventListener('dragover', (e) => {
  e.preventDefault();
  uploadArea.classList.add('dragover');
});

uploadArea.addEventListener('dragleave', () => {
  uploadArea.classList.remove('dragover');
});

uploadArea.addEventListener('drop', (e) => {
  e.preventDefault();
  uploadArea.classList.remove('dragover');
  handleFiles(e.dataTransfer.files);
});

fileInput.addEventListener('change', () => {
  handleFiles(fileInput.files);
  fileInput.value = '';
});

function handleFiles(files) {
  for (const file of files) {
    if (!file.type.startsWith('image/')) {
      showToast('âŒ ä»…æ”¯æŒå›¾ç‰‡æ–‡ä»¶', 'error');
      continue;
    }
    const reader = new FileReader();
    reader.onload = (e) => {
      const id = 'custom_' + (++customIdCounter);
      const name = file.name.replace(/\.[^.]+$/, '');
      customGauges.push({ id, name, dataUrl: e.target.result });
      renderCustomGauges();
      showToast('âœ… å·²æ·»åŠ : ' + name, 'success');
    };
    reader.readAsDataURL(file);
  }
}

function renderCustomGauges() {
  const container = document.getElementById('customGaugesContainer');
  const grid = document.getElementById('customGaugeGrid');
  
  if (customGauges.length === 0) {
    container.style.display = 'none';
    return;
  }
  
  container.style.display = 'block';
  grid.innerHTML = customGauges.map(g => `
    <div class="gauge-card" data-gauge="${g.id}" data-type="custom">
      <img class="gauge-card-image" src="${g.dataUrl}" alt="${g.name}">
      <div class="gauge-card-body">
        <div class="gauge-card-header">
          <span class="gauge-card-name">${g.name}</span>
          <span class="badge badge-custom">è‡ªå®šä¹‰</span>
        </div>
        <p class="gauge-card-desc">ç”¨æˆ·ä¸Šä¼ çš„è‡ªå®šä¹‰è¡¨ç›˜</p>
        <div class="gauge-card-actions">
          <button class="btn btn-secondary" onclick="previewGauge('${g.id}')">ğŸ‘ é¢„è§ˆ</button>
          <button class="btn btn-primary" onclick="selectCustomGauge('${g.id}')">âœ… é€‰æ‹©</button>
          <button class="btn btn-secondary" onclick="removeCustomGauge('${g.id}')" style="color:var(--accent)">ğŸ—‘</button>
        </div>
      </div>
    </div>
  `).join('');
}

function removeCustomGauge(id) {
  customGauges = customGauges.filter(g => g.id !== id);
  if (selectedGauge && selectedGauge.id === id) {
    selectedGauge = null;
  }
  renderCustomGauges();
  showToast('å·²åˆ é™¤è‡ªå®šä¹‰è¡¨ç›˜', 'success');
}

// ===== Download Selection Display =====
function updateSelectionDisplay() {
  const el = document.getElementById('currentSelection');
  if (!selectedGauge) {
    el.innerHTML = '<p style="color:var(--text-muted)">å°šæœªé€‰æ‹©ä»»ä½•è¡¨ç›˜ï¼Œè¯·å‰å¾€ã€Œè¡¨ç›˜ã€é¡µé¢é€‰æ‹©ã€‚</p>';
    return;
  }
  el.innerHTML = `
    <div class="selected-item">
      <img src="${selectedGauge.src}" alt="${selectedGauge.name}">
      <span class="selected-item-name">${selectedGauge.name}</span>
      <span class="badge ${selectedGauge.type === 'preset' ? 'badge-preset' : 'badge-custom'}">${selectedGauge.type === 'preset' ? 'é¢„åˆ¶' : 'è‡ªå®šä¹‰'}</span>
    </div>
  `;
}

// ===== Generate textures.ini =====
function generateTexturesIni() {
  let content = '[options]\n';
  content += 'version = 1\n';
  content += 'hash = quick\n\n';
  content += '[hashes]\n';
  for (const hash of TACHOMETER_HASHES) {
    content += hash + ' = CAUGE/' + SPEED_FILENAME + '\n';
  }
  return content;
}

// ===== Download Functions =====
async function downloadPackage(platform) {
  if (!selectedGauge) {
    showToast('âŒ è¯·å…ˆé€‰æ‹©ä¸€ä¸ªè¡¨ç›˜', 'error');
    return;
  }
  
  showToast('â³ æ­£åœ¨ç”Ÿæˆæ–‡ä»¶åŒ…...', 'success');
  
  try {
    // Load JSZip from CDN
    if (typeof JSZip === 'undefined') {
      await loadScript('https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js');
    }
    
    const zip = new JSZip();
    
    // Add textures.ini
    zip.file('textures.ini', generateTexturesIni());
    
    // Add gauge image
    const imageBlob = await getImageBlob(selectedGauge);
    zip.file('CAUGE/' + SPEED_FILENAME, imageBlob);
    
    // Generate zip
    const blob = await zip.generateAsync({ type: 'blob' });
    const filename = platform === 'windows' 
      ? 'InitialD_Tachometer_Windows.zip' 
      : 'InitialD_Tachometer_Android.zip';
    
    downloadBlob(blob, filename);
    showToast('âœ… æ–‡ä»¶åŒ…ä¸‹è½½æˆåŠŸï¼', 'success');
  } catch (err) {
    console.error(err);
    showToast('âŒ ç”Ÿæˆå¤±è´¥: ' + err.message, 'error');
  }
}

function downloadIniOnly() {
  const content = generateTexturesIni();
  const blob = new Blob([content], { type: 'text/plain' });
  downloadBlob(blob, 'textures.ini');
  showToast('âœ… textures.ini ä¸‹è½½æˆåŠŸï¼', 'success');
}

async function getImageBlob(gauge) {
  if (gauge.type === 'custom') {
    // Convert data URL to blob
    const res = await fetch(gauge.src);
    return await res.blob();
  } else {
    // Fetch preset image
    const res = await fetch(gauge.src);
    return await res.blob();
  }
}

function downloadBlob(blob, filename) {
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = filename;
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
}

function loadScript(src) {
  return new Promise((resolve, reject) => {
    const script = document.createElement('script');
    script.src = src;
    script.onload = resolve;
    script.onerror = reject;
    document.head.appendChild(script);
  });
}

// ===== Toast =====
function showToast(message, type) {
  const toast = document.getElementById('toast');
  toast.textContent = message;
  toast.className = 'toast ' + type;
  requestAnimationFrame(() => {
    toast.classList.add('show');
  });
  clearTimeout(toast._timer);
  toast._timer = setTimeout(() => {
    toast.classList.remove('show');
  }, 2500);
}

// ===== Keyboard =====
document.addEventListener('keydown', (e) => {
  if (e.key === 'Escape') closePreview();
});
</script>

</body>
</html>
